<?xml version="1.0" encoding="UTF-8"?>
<svg width="100%" viewBox="0 0 1550 650" xmlns="http://www.w3.org/2000/svg">
    
    <defs>
        <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
            <polygon points="0 0, 10 3.5, 0 7" fill="#888" />
        </marker>
        <marker id="dot-blue" markerWidth="8" markerHeight="8" refX="4" refY="4">
            <circle cx="4" cy="4" r="3" fill="#339af0" />
        </marker>
        <style>
            .flow-line { stroke: #adb5bd; stroke-width: 2; fill: none; stroke-dasharray: 6 4; }
            .particle { fill: #339af0; }
            @keyframes flow {
                0% { stroke-dashoffset: 20; }
                100% { stroke-dashoffset: 0; }
            }
            .anim-flow { animation: flow 1s linear infinite; }
            .title-text { font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-weight: bold; fill: #495057; }
            .label-text { font-family: 'Courier New', monospace; fill: #868e96; font-size: 12px; }
            .module-box { fill: #ffffff; stroke: #339af0; stroke-width: 2; rx: 6; ry: 6; filter: drop-shadow(0px 4px 4px rgba(0,0,0,0.05)); }
            .module-header { fill: #e7f5ff; }
            .io-pin { fill: #339af0; stroke: #fff; stroke-width: 1; }
            .cru-box { fill: #f8f9fa; stroke: #339af0; stroke-width: 3; rx: 12; ry: 12; filter: drop-shadow(0px 8px 12px rgba(0,0,0,0.1)); }
            .cru-title { font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-weight: bold; fill: #1c7ed6; font-size: 20px;}
            .cru-subtitle { font-family: 'Courier New', monospace; fill: #495057; font-size: 14px;}
        </style>
    </defs>
    
    
    <!-- 1. Encoders -->
    
    <g id="encoders" transform="translate(50, 180)">
        <g transform="translate(0, 0)">
            <rect x="0" y="0" width="140" height="60" class="module-box" />
            <rect x="0" y="0" width="140" height="20" class="module-header" rx="6" ry="6" />
            <rect x="0" y="10" width="140" height="10" fill="#e7f5ff" />
            <text x="70" y="15" text-anchor="middle" class="label-text" style="font-weight:bold; fill:#1c7ed6;">TEXT_ENC_V2</text>
            <text x="70" y="45" text-anchor="middle" class="title-text" font-size="14">Transformer</text>
            <circle cx="140" cy="30" r="4" class="io-pin" />
        </g>
        <g transform="translate(20, 80)">
            <rect x="0" y="0" width="140" height="60" class="module-box" style="stroke: #be4bdb;" />
            <rect x="0" y="0" width="140" height="20" class="module-header" style="fill: #f3d9fa;" rx="6" ry="6" />
            <rect x="0" y="10" width="140" height="10" fill="#f3d9fa" />
            <text x="70" y="15" text-anchor="middle" class="label-text" style="font-weight:bold; fill:#9c36b5;">VISION_ViT</text>
            <text x="70" y="45" text-anchor="middle" class="title-text" font-size="14">ResNet/ViT</text>
            <circle cx="140" cy="30" r="4" class="io-pin" style="fill:#be4bdb;" />
        </g>
        <g transform="translate(0, 160)">
            <rect x="0" y="0" width="140" height="60" class="module-box" style="stroke: #40c057;" />
            <rect x="0" y="0" width="140" height="20" class="module-header" style="fill: #d3f9d8;" rx="6" ry="6" />
            <rect x="0" y="10" width="140" height="10" fill="#d3f9d8" />
            <text x="70" y="15" text-anchor="middle" class="label-text" style="font-weight:bold; fill:#2b8a3e;">AUDIO_SPEC</text>
            <text x="70" y="45" text-anchor="middle" class="title-text" font-size="14">Conformer</text>
            <circle cx="140" cy="30" r="4" class="io-pin" style="fill:#40c057;" />
        </g>
        <path d="M 150 30 L 170 30 L 170 190 L 150 190" fill="none" stroke="#ced4da" stroke-width="2" />
        <circle cx="170" cy="110" r="5" fill="#868e96" />
    </g>
    
    
    <!-- 2. Central Reasoning Unit (NEW FROM SCRATCH) -->
    
    <g id="cru-new" transform="translate(400, 50)">
        <rect x="0" y="0" width="460" height="400" class="cru-box" />
        <path d="M 0 60 L 460 60" stroke="#e9ecef" stroke-width="2" />
        <text x="230" y="40" text-anchor="middle" class="cru-title">CENTRAL REASONING UNIT</text>
        <text x="230" y="200" text-anchor="middle" class="cru-subtitle" font-size="18">LLM / VLM CORE</text>
        <g opacity="0.1">
            <line x1="50" y1="100" x2="410" y2="100" stroke="#339af0" stroke-width="1" />
            <line x1="50" y1="300" x2="410" y2="300" stroke="#339af0" stroke-width="1" />
            <rect x="180" y="150" width="100" height="100" stroke="#339af0" stroke-width="2" fill="none" rx="4" />
        </g>
        <circle cx="0" cy="200" r="10" fill="#339af0" stroke="#fff" stroke-width="3" />
        <circle cx="460" cy="200" r="10" fill="#339af0" stroke="#fff" stroke-width="3" />
    </g>
    
    
    <!-- 3. Execution Graph (EXPANDED CONTEXTS) -->
    
    <g id="exec-graph" transform="translate(940, 50)">
        <!-- Container Background -->
        <rect x="-20" y="-20" width="550" height="450" fill="#f8f9fa" stroke="#e9ecef" stroke-dasharray="4 4" rx="20" />
        <text x="10" y="0" class="label-text" fill="#adb5bd" font-size="14">EXECUTION_CONTEXT_RUNTIME</text>

        <!-- BLOCK 1: ORCHESTRATOR (Root) -->
        <g transform="translate(0, 150)">
            <rect x="0" y="0" width="180" height="90" class="module-box" />
            <rect x="0" y="0" width="180" height="25" fill="#e7f5ff" rx="6" ry="6" />
            <rect x="0" y="10" width="180" height="15" fill="#e7f5ff" />
            <text x="10" y="18" class="label-text" fill="#1c7ed6" font-weight="bold">CTX-01: ROOT</text>
            <text x="90" y="55" text-anchor="middle" class="title-text" font-size="14">Orchestrator</text>
            <text x="20" y="78" class="label-text" font-size="10">State: <tspan fill="#40c057">ACTIVE</tspan></text>
            <circle cx="0" cy="45" r="5" class="io-pin" />
            <circle cx="180" cy="45" r="5" class="io-pin" />
        </g>
        
        <!-- BLOCK 2: WEB SEARCH -->
        <g transform="translate(280, 20)">
            <rect x="0" y="0" width="180" height="80" class="module-box" style="stroke: #fa5252;" />
            <rect x="0" y="0" width="180" height="25" fill="#ffe3e3" rx="6" ry="6" />
            <rect x="0" y="10" width="180" height="15" fill="#ffe3e3" />
            <text x="10" y="18" class="label-text" fill="#e03131" font-weight="bold">CTX-02: EXT_KNOW</text>
            <text x="90" y="50" text-anchor="middle" class="title-text" font-size="14">Web Search</text>
            <circle cx="0" cy="40" r="5" class="io-pin" style="fill:#fa5252;" />
        </g>
        
        <!-- BLOCK 3: CODE INTERPRETER -->
        <g transform="translate(280, 150)">
            <rect x="0" y="0" width="180" height="80" class="module-box" style="stroke: #fab005;" />
            <rect x="0" y="0" width="180" height="25" fill="#fff9db" rx="6" ry="6" />
            <rect x="0" y="10" width="180" height="15" fill="#fff9db" />
            <text x="10" y="18" class="label-text" fill="#f08c00" font-weight="bold">CTX-03: LOGIC</text>
            <text x="90" y="50" text-anchor="middle" class="title-text" font-size="14">Python Kernel</text>
            <circle cx="0" cy="40" r="5" class="io-pin" style="fill:#fab005;" />
        </g>
        
        <!-- BLOCK 4: VECTOR DB -->
        <g transform="translate(280, 280)">
            <rect x="0" y="0" width="180" height="80" class="module-box" style="stroke: #20c997;" />
            <rect x="0" y="0" width="180" height="25" fill="#e6fcf5" rx="6" ry="6" />
            <rect x="0" y="10" width="180" height="15" fill="#e6fcf5" />
            <text x="10" y="18" class="label-text" fill="#0ca678" font-weight="bold">CTX-04: MEMORY</text>
            <text x="90" y="50" text-anchor="middle" class="title-text" font-size="14">Vector Store</text>
            <circle cx="0" cy="40" r="5" class="io-pin" style="fill:#20c997;" />
        </g>

        <!-- Internal Flows -->
        <path d="M 180 195 C 230 195, 230 60, 280 60" class="flow-line" />
        <path d="M 180 195 C 230 195, 230 190, 280 190" class="flow-line" />
        <path d="M 180 195 C 230 195, 230 320, 280 320" class="flow-line" />
    </g>
    
    
    <!-- 4. Connections -->
    
    <g id="global-connections">
        <!-- Left Bus to CRU Input -->
        <path d="M 220 290 C 300 290, 300 250, 400 250" class="flow-line anim-flow" style="stroke: #868e96; stroke-width: 3;" />
        <circle cx="220" cy="290" r="4" fill="#868e96" />
        
        <!-- CRU Output to Right Input -->
        <path d="M 860 250 C 900 250, 910 245, 940 245" class="flow-line anim-flow" style="stroke: #339af0; stroke-width: 3;" />
        <circle cx="940" cy="245" r="4" fill="#4dabf7" />
    </g>
    
    
    <!-- Title -->
    <text x="775" y="630" text-anchor="middle" font-family="'Times New Roman', serif" font-size="24" fill="#343a40">
        Figure 1: Neuro-Symbolic Cognitive Architecture (v4.0 - Context Blocks)
    </text>
</svg>
